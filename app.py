from flask import Flask, render_template, request, redirect
from es_search import *
import json
from joblib import load
nlp_food = load('./NER/my_trained_model.pkl')

app = Flask(__name__, static_folder='./static')

sample_1 = [{'name': 'Stockyard Sandwich', 'star': 4.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9630709056, 'longitude': -75.164270103, 'city': 'Philadelphia'}, {'name': "Lisa's Kitchen", 'star': 4.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 40.0192761664, 'longitude': -75.2107855641, 'city': 'Philadelphia'}, {'name': "John's Roast Pork", 'star': 4.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9210273851, 'longitude': -75.1450284438, 'city': 'Philadelphia'}, {'name': "George's Sandwich Shop", 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9388315986, 'longitude': -75.1579846257, 'city': 'Philadelphia'}, {'name': 'Wedge + Fig', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9538296, 'longitude': -75.1449499, 'city': 'Philadelphia'}, {'name': "Poe's Sandwich Joint", 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9773029, 'longitude': -75.1436018, 'city': 'Philadelphia'}, {'name': "Tommy DiNic's", 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.95347837, 'longitude': -75.1593960603, 'city': 'Philadelphia'}, {'name': "Pat's King of Steaks", 'star': 3.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9332010583, 'longitude': -75.159265814, 'city': 'Philadelphia'}, {'name': "Fino's Pizzeria & Restaurant", 'star': 3.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 40.0545606, 'longitude': -75.1869682, 'city': 'Philadelphia'}]
sample_2 = [{'name': 'Kanella', 'star': 4.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9463322, 'longitude': -75.1579478, 'city': 'Philadelphia'}, {'name': 'Lacroix Restaurant at The Rittenhouse', 'star': 4.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9499125, 'longitude': -75.1736448, 'city': 'Philadelphia'}, {'name': 'Hawthornes Biercafé', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9410364, 'longitude': -75.1608686, 'city': 'Philadelphia'}, {'name': 'Parc', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9491724, 'longitude': -75.1707273, 'city': 'Philadelphia'}, {'name': 'Silk City Diner & Lounge', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9613271, 'longitude': -75.1460328, 'city': 'Philadelphia'}, {'name': 'Harp & Crown', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9504170438, 'longitude': -75.1664282754, 'city': 'Philadelphia'}, {'name': 'The Common PHL', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9566244, 'longitude': -75.194436, 'city': 'Philadelphia'}, {'name': 'Max Brenner - Philadelphia', 'star': 3.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 39.9491000076, 'longitude': -75.1661748827, 'city': 'Philadelphia'}, {'name': "Winnie's Manayunk", 'star': 3.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 40.024735, 'longitude': -75.2222673, 'city': 'Philadelphia'}]
sample_3 = [{'name': 'On Swann', 'star': 4.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.9374616, 'longitude': -82.4751492, 'city': 'Tampa'}, {'name': 'Oystercatchers', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.962275, 'longitude': -82.549347, 'city': 'Tampa'}, {'name': 'edison: food+drink lab', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.944244, 'longitude': -82.469306, 'city': 'Tampa'}, {'name': 'Haiku Tampa', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.9510496391, 'longitude': -82.4601829854, 'city': 'Tampa'}, {'name': 'Flor Fina', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.960766, 'longitude': -82.443715, 'city': 'Tampa'}, {'name': 'Rusty Pelican - Tampa', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.962265, 'longitude': -82.569991, 'city': 'Tampa'}, {'name': 'Boca - Tampa', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.9418973, 'longitude': -82.4688025, 'city': 'Tampa'}, {'name': "Gaspar's Grotto", 'star': 3.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.9601002, 'longitude': -82.4389551, 'city': 'Tampa'}, {'name': 'Jacksons Bistro Bar & Sushi', 'star': 3.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.9387237, 'longitude': -82.4548811, 'city': 'Tampa'}]
sample_4 = [{'name': 'Hotel Bar', 'star': 4.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.94616, 'longitude': -82.458392, 'city': 'Tampa'}, {'name': 'The Anchor Bar', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.9489015, 'longitude': -82.4588166, 'city': 'Tampa'}, {'name': 'Señor Tequila Mexican Restaurant - Tampa', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 28.050129822, 'longitude': -82.5031507015, 'city': 'Tampa'}, {'name': "Mita's Kitchen", 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.960558, 'longitude': -82.44018, 'city': 'Tampa'}, {'name': 'Bilmar Station', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.9977099719, 'longitude': -82.5794927964, 'city': 'Tampa'}, {'name': 'La La’s Sangria Bar', 'star': 3.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.9488681449, 'longitude': -82.4484995614, 'city': 'Tampa'}, {'name': 'Boneyard', 'star': 3.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.9600821, 'longitude': -82.438332, 'city': 'Tampa'}, {'name': "Bobalouie's Grille & Sports Garden", 'star': 3.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 28.0799882, 'longitude': -82.4362843, 'city': 'Tampa'}, {'name': 'Yard of Ale Soho', 'star': 3.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.9405722, 'longitude': -82.4827532, 'city': 'Tampa'}, {'name': "Applebee's Grill + Bar", 'star': 2.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 27.995639, 'longitude': -82.509749, 'city': 'Tampa'}]
sample_5 = [{'name': 'Castnet Seafood', 'star': 4.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 30.0515811, 'longitude': -89.9789026, 'city': 'New Orleans'}, {'name': "Mr. B's Bistro", 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 29.9543868, 'longitude': -90.0683629, 'city': 'New Orleans'}, {'name': 'Napoleon House', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 29.9558463513, 'longitude': -90.0651807227, 'city': 'New Orleans'}, {'name': "The Original Pierre Maspero's", 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 29.9556758, 'longitude': -90.0652064, 'city': 'New Orleans'}, {'name': 'Cajun Seafood', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 29.9711981, 'longitude': -90.0677061, 'city': 'New Orleans'}, {'name': 'BOIL Seafood House', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 29.92296, 'longitude': -90.0886304, 'city': 'New Orleans'}, {'name': 'Olde Nola Cookery', 'star': 4.0, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 29.9548610123, 'longitude': -90.0689931303, 'city': 'New Orleans'}, {'name': 'Bourbon House', 'star': 3.5, 'attributes': [], 'service': True, 'Menu': [], 'latitude': 29.954618, 'longitude': -90.06918, 'city': 'New Orleans'}]


@app.route('/input', methods=['GET', 'POST'])
def register():
    data = json.loads(request.data)     # 获取form表单提交过来的非文件数据,类似字典
    keyword = data["keyword"]
    city = data["Location"]
    dining_time = data["date"]
    res = searchResults(keyword, city, nlp_food, dining_time)
    print(res)
        # 用sample_data做测试
    return json.dumps(res)
    #except:
    #    return "not receiving data"


@app.route('/')
def index():
    return render_template('index.html')


if __name__ == '__main__':
    app.run(debug=True)
